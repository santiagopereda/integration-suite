# Ansible Variable Management Best Practices

# This template demonstrates proper variable organization and usage patterns

---
# defaults/main.yml - Default Variables (Lowest Precedence)
# Use for variables users are expected to override

# Application Configuration
app_name: myapp
app_version: "1.0.0"
app_port: 8080
app_user: "{{ app_name }}"
app_group: "{{ app_name }}"

# Paths (use variable composition)
app_base_dir: "/opt/{{ app_name }}"
app_install_dir: "{{ app_base_dir }}/releases/{{ app_version }}"
app_config_dir: "/etc/{{ app_name }}"
app_log_dir: "/var/log/{{ app_name }}"
app_data_dir: "/var/lib/{{ app_name }}"

# Feature Flags (boolean variables)
app_enable_ssl: true
app_enable_monitoring: false
app_enable_backup: true
app_debug_mode: false

# Nested Configuration (dictionary)
app_database:
  host: localhost
  port: 5432
  name: "{{ app_name }}_db"
  user: "{{ app_name }}_user"
  # Password should come from vault_* variable

# List Variables
app_required_packages:
  - python3
  - python3-pip
  - git

app_python_dependencies:
  - flask==2.0.1
  - sqlalchemy==1.4.25
  - redis==3.5.3

# Environment-Specific Defaults
app_environment: development
app_log_level: info

---
# vars/main.yml - Role Variables (Higher Precedence)
# Use for variables users should NOT override

# Internal Role Variables
_app_service_name: "{{ app_name }}.service"
_app_config_file: "{{ app_config_dir }}/{{ app_name }}.conf"
_app_systemd_unit: "/etc/systemd/system/{{ _app_service_name }}"

# Version-Specific Settings (not meant to be overridden)
_app_supported_versions:
  - "1.0.0"
  - "1.1.0"
  - "2.0.0"

---
# vars/[OS].yml - OS-Specific Variables
# Automatically loaded based on ansible_os_family

# vars/Debian.yml
_app_package_manager: apt
_app_service_manager: systemd
_app_required_system_packages:
  - build-essential
  - libssl-dev

# vars/RedHat.yml
_app_package_manager: yum
_app_service_manager: systemd
_app_required_system_packages:
  - gcc
  - openssl-devel

---
# Variable Usage in Tasks

# Good Practice: Use Variables for Flexibility
- name: Create application directory
  ansible.builtin.file:
    path: "{{ app_install_dir }}"
    state: directory
    owner: "{{ app_user }}"
    group: "{{ app_group }}"
    mode: '0755'

# Good Practice: Default Values for Optional Variables
- name: Set log level
  ansible.builtin.lineinfile:
    path: "{{ _app_config_file }}"
    regexp: '^log_level='
    line: "log_level={{ app_log_level | default('info') }}"

# Good Practice: Conditional Variables
- name: Install development dependencies
  ansible.builtin.pip:
    name: "{{ app_dev_dependencies }}"
    state: present
  when: app_environment == 'development'

# Good Practice: Variable Composition
- name: Deploy configuration
  ansible.builtin.template:
    src: "{{ app_name }}.conf.j2"
    dest: "{{ _app_config_file }}"
    owner: "{{ app_user }}"
    mode: '0644'

---
# Variable Precedence (Lowest to Highest)

# 1. role defaults (defaults/main.yml)
# 2. inventory file or script group vars
# 3. inventory group_vars/all
# 4. playbook group_vars/all
# 5. inventory group_vars/*
# 6. playbook group_vars/*
# 7. inventory file or script host vars
# 8. inventory host_vars/*
# 9. playbook host_vars/*
# 10. host facts / cached set_facts
# 11. play vars
# 12. play vars_prompt
# 13. play vars_files
# 14. role vars (vars/main.yml)
# 15. block vars (only for tasks in block)
# 16. task vars (only for the task)
# 17. include_vars
# 18. set_facts / registered vars
# 19. role (and include_role) params
# 20. include params
# 21. extra vars (always win, -e flag)

---
# Naming Conventions

# ✅ DO:
app_setting_name: value           # Descriptive, prefixed with role name
_internal_variable: value         # Prefix internal vars with underscore
APP_CONSTANT: value               # ALL_CAPS for constants (rare)
feature_enabled: true             # Boolean: clear yes/no naming

# ❌ DON'T:
var: value                        # Too generic, no context
myVar: value                      # camelCase (use snake_case)
app-setting: value                # Hyphens (use underscores)

---
# Variable Types and Examples

# String
app_name: "myapplication"

# Integer
app_port: 8080

# Boolean (use true/false, not yes/no)
app_enabled: true

# List
app_packages:
  - package1
  - package2

# Dictionary
app_config:
  setting1: value1
  setting2: value2
  nested:
    key: value

# Multi-line String
app_description: |
  This is a multi-line
  description of the
  application

# Multi-line String (folded)
app_long_string: >
  This is a long string
  that will be folded
  into a single line

---
# Vault Variables Pattern

# In defaults/main.yml - Reference vault variables
app_admin_password: "{{ vault_app_admin_password }}"
app_api_key: "{{ vault_app_api_key }}"
app_secret_key: "{{ vault_app_secret_key }}"

# In vars/vault.yml (encrypted with ansible-vault)
vault_app_admin_password: "super_secret_password"
vault_app_api_key: "api_key_12345"
vault_app_secret_key: "secret_key_67890"

# Usage in tasks with no_log
- name: Set admin password
  ansible.builtin.user:
    name: admin
    password: "{{ app_admin_password | password_hash('sha512') }}"
  no_log: true

---
# Variable Documentation Template

# Include this in your role's README.md:

# ### Variable Name
# - **Description**: What this variable controls
# - **Type**: string|integer|boolean|list|dict
# - **Default**: default_value
# - **Required**: yes|no
# - **Example**: example_value
# - **Notes**: Additional context or warnings

---
# Best Practices Summary

# ✅ DO:
# - Use snake_case for variable names
# - Prefix role variables with role name
# - Use underscore prefix for internal variables
# - Provide sensible defaults in defaults/main.yml
# - Document all variables in README
# - Use vault for sensitive data
# - Use variable composition (build complex from simple)
# - Apply filters appropriately (default, mandatory, etc.)
# - Group related variables in dictionaries

# ❌ DON'T:
# - Use generic variable names without context
# - Hardcode values in tasks (use variables)
# - Store sensitive data unencrypted
# - Mix variable types (string vs integer)
# - Override role vars/main.yml (use defaults)
# - Use reserved Ansible variable names
# - Create deeply nested dictionaries (keep it simple)

---
# Template Version: 1.0.0
# Last Updated: 2025-11-28
# Maintained By: Agent Architecture Team
