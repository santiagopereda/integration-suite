# Ansible Inventory Management Patterns

# This file demonstrates static and dynamic inventory patterns for Ansible

---
# === STATIC INVENTORY - INI FORMAT ===

# inventory/production/hosts (INI format)
[webservers]
web1.example.com ansible_host=192.168.1.10
web2.example.com ansible_host=192.168.1.11
web3.example.com ansible_host=192.168.1.12

[databases]
db1.example.com ansible_host=192.168.1.20 ansible_port=5432
db2.example.com ansible_host=192.168.1.21 ansible_port=5432

[loadbalancers]
lb1.example.com ansible_host=192.168.1.30

# Group variables
[webservers:vars]
ansible_user=deploy
ansible_python_interpreter=/usr/bin/python3
http_port=80
https_port=443

[databases:vars]
ansible_user=dbadmin
db_backup_enabled=true

# Parent groups
[production:children]
webservers
databases
loadbalancers

[production:vars]
environment=production
monitoring_enabled=true

---
# === STATIC INVENTORY - YAML FORMAT ===

# inventory/production/hosts.yml (YAML format)
all:
  children:
    webservers:
      hosts:
        web1.example.com:
          ansible_host: 192.168.1.10
          server_role: primary
        web2.example.com:
          ansible_host: 192.168.1.11
          server_role: secondary
        web3.example.com:
          ansible_host: 192.168.1.12
          server_role: secondary
      vars:
        ansible_user: deploy
        ansible_python_interpreter: /usr/bin/python3
        http_port: 80

    databases:
      hosts:
        db1.example.com:
          ansible_host: 192.168.1.20
          db_role: master
        db2.example.com:
          ansible_host: 192.168.1.21
          db_role: replica
      vars:
        ansible_user: dbadmin
        ansible_port: 5432

    loadbalancers:
      hosts:
        lb1.example.com:
          ansible_host: 192.168.1.30

    production:
      children:
        - webservers
        - databases
        - loadbalancers
      vars:
        environment: production
        monitoring_enabled: true

---
# === COMMON INVENTORY VARIABLES ===

# Connection Variables
ansible_host: 192.168.1.100          # Target IP/hostname
ansible_port: 22                     # SSH port (default: 22)
ansible_user: deploy                 # Remote user
ansible_connection: ssh              # Connection type (ssh, local, winrm)
ansible_ssh_private_key_file: /path/to/key.pem

# Python Interpreter
ansible_python_interpreter: /usr/bin/python3  # Python path on target

# Privilege Escalation
ansible_become: yes                  # Enable privilege escalation
ansible_become_method: sudo          # Method (sudo, su, pbrun, etc.)
ansible_become_user: root            # Target user for become

# SSH Settings
ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
ansible_ssh_extra_args: '-o ControlMaster=auto -o ControlPersist=60s'

---
# === HOST AND GROUP PATTERNS ===

# Single host
ansible-playbook playbook.yml -i inventory -l web1.example.com

# All hosts in a group
ansible-playbook playbook.yml -i inventory -l webservers

# Multiple groups
ansible-playbook playbook.yml -i inventory -l webservers:databases

# Exclude hosts/groups
ansible-playbook playbook.yml -i inventory -l 'all:!databases'

# Intersection (both groups)
ansible-playbook playbook.yml -i inventory -l 'webservers:&production'

# Regex pattern
ansible-playbook playbook.yml -i inventory -l 'web*.example.com'

# Multiple patterns
ansible-playbook playbook.yml -i inventory -l 'web1*:web2*'

---
# === DYNAMIC INVENTORY - AWS EC2 ===

# Dynamic inventory plugin configuration
# inventory/aws_ec2.yml

plugin: amazon.aws.aws_ec2
regions:
  - us-east-1
  - us-west-2

# Filter instances
filters:
  tag:Environment: production
  instance-state-name: running

# Group by tags
keyed_groups:
  - key: tags.Environment
    prefix: env
  - key: tags.Application
    prefix: app
  - key: placement.availability_zone
    prefix: az

# Compose variables from instance metadata
compose:
  ansible_host: public_ip_address
  ansible_user: ec2-user

# Hostnames
hostnames:
  - tag:Name
  - dns-name

---
# === DYNAMIC INVENTORY - AZURE ===

# inventory/azure_rm.yml
plugin: azure.azcollection.azure_rm
auth_source: auto
include_vm_resource_groups:
  - production-rg

keyed_groups:
  - key: tags.environment
    prefix: env
  - key: location
    prefix: region

compose:
  ansible_host: public_ipv4_addresses[0]
  ansible_user: azureuser

---
# === DYNAMIC INVENTORY - GCP ===

# inventory/gcp_compute.yml
plugin: google.cloud.gcp_compute
projects:
  - my-gcp-project
filters:
  - labels.environment = production
  - status = RUNNING

keyed_groups:
  - key: labels.environment
    prefix: env
  - key: zone
    prefix: zone

compose:
  ansible_host: networkInterfaces[0].accessConfigs[0].natIP
  ansible_user: ansible

---
# === INVENTORY DIRECTORY STRUCTURE ===

# Organized inventory layout
inventory/
├── production/
│   ├── hosts.yml                # Main inventory
│   ├── group_vars/
│   │   ├── all.yml              # Variables for all hosts
│   │   ├── webservers.yml       # Web server specific vars
│   │   └── databases.yml        # Database specific vars
│   └── host_vars/
│       ├── web1.example.com.yml # Host-specific variables
│       └── db1.example.com.yml
├── staging/
│   ├── hosts.yml
│   ├── group_vars/
│   └── host_vars/
└── development/
    ├── hosts.yml
    ├── group_vars/
    └── host_vars/

---
# === VAULT INTEGRATION ===

# inventory/production/group_vars/all.yml (encrypted with ansible-vault)
vault_db_password: super_secret_password
vault_api_key: confidential_key
vault_ssl_key_password: ssl_password

# inventory/production/group_vars/all/vars.yml (unencrypted references)
db_password: "{{ vault_db_password }}"
api_key: "{{ vault_api_key }}"
ssl_key_password: "{{ vault_ssl_key_password }}"

---
# === BEST PRACTICES ===

# ✅ DO:
# - Use descriptive host and group names
# - Organize by environment (production, staging, development)
# - Use group_vars and host_vars for variables
# - Encrypt sensitive data with ansible-vault
# - Use dynamic inventory for cloud providers
# - Document inventory structure in README
# - Use consistent naming conventions
# - Keep inventory DRY (don't repeat yourself)

# ❌ DON'T:
# - Hardcode credentials in inventory
# - Mix environments in same inventory file
# - Use overly complex group structures
# - Duplicate variables across files
# - Forget to version control inventory
# - Leave default credentials in place

---
# === TESTING INVENTORY ===

# List all hosts
ansible-inventory -i inventory --list

# List specific group
ansible-inventory -i inventory --graph webservers

# Check host variables
ansible-inventory -i inventory --host web1.example.com

# Verify inventory structure
ansible-playbook playbook.yml -i inventory --list-hosts

---
# Template Version: 1.0.0
# Last Updated: 2025-11-28
# Maintained By: Agent Architecture Team
